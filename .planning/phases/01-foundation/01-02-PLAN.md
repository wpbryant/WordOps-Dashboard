---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [backend/auth/__init__.py, backend/auth/models.py, backend/auth/utils.py, backend/auth/routes.py, backend/main.py]
autonomous: true
---

<objective>
Implement JWT authentication system with login endpoint and token validation.

Purpose: Secure the dashboard API with token-based authentication.
Output: Working login endpoint, JWT utilities, auth middleware pattern.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth models and JWT utilities</name>
  <files>backend/auth/__init__.py, backend/auth/models.py, backend/auth/utils.py, backend/config.py</files>
  <action>
    Create backend/auth/ directory with __init__.py (empty).

    Create backend/auth/models.py:
    - Pydantic models: LoginRequest (username: str, password: str), Token (access_token: str, token_type: str), TokenData (username: str | None)
    - User model for internal use (username: str, hashed_password: str)

    Create backend/auth/utils.py:
    - verify_password(plain: str, hashed: str) -> bool using passlib bcrypt
    - get_password_hash(password: str) -> str
    - create_access_token(data: dict, expires_delta: timedelta | None) -> str using python-jose
    - decode_token(token: str) -> TokenData | None
    - Use HS256 algorithm, get SECRET_KEY from Settings
    - Default token expiry: 60 minutes

    Update backend/config.py:
    - Add ACCESS_TOKEN_EXPIRE_MINUTES (int, default 60)
    - Add ADMIN_USERNAME (str, default "admin")
    - Add ADMIN_PASSWORD_HASH (str) - for single-user auth

    Do NOT use a database. Single admin user defined in config for v1.
  </action>
  <verify>cd /home/william/Projects/WordOps-Dashboard && python3 -c "from backend.auth.utils import create_access_token, verify_password; print('Auth utils OK')"</verify>
  <done>JWT utilities work, password hashing works</done>
</task>

<task type="auto">
  <name>Task 2: Create auth routes and wire to app</name>
  <files>backend/auth/routes.py, backend/auth/dependencies.py, backend/main.py</files>
  <action>
    Create backend/auth/dependencies.py:
    - get_current_user dependency using OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login")
    - Decode JWT from Authorization header, validate, return user
    - Raise HTTPException 401 if invalid/expired

    Create backend/auth/routes.py:
    - APIRouter with prefix="/api/v1/auth", tags=["auth"]
    - POST /login accepting OAuth2PasswordRequestForm (form data: username, password)
    - Verify against ADMIN_USERNAME and ADMIN_PASSWORD_HASH from config
    - Return Token on success, 401 on failure
    - GET /me requiring get_current_user dependency, returns {"username": user.username}

    Update backend/main.py:
    - Import and include auth router
    - Add a protected test endpoint GET /api/v1/protected that requires auth

    Use OAuth2PasswordRequestForm (from fastapi.security) for login - this is standard form-based OAuth2.
  </action>
  <verify>cd /home/william/Projects/WordOps-Dashboard && python3 -c "from backend.main import app; routes = [r.path for r in app.routes]; assert '/api/v1/auth/login' in routes or any('login' in str(r.path) for r in app.routes); print('Auth routes OK')"</verify>
  <done>Login endpoint exists, protected routes require auth</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python3 -c "from backend.auth.utils import create_access_token"` succeeds
- [ ] `python3 -c "from backend.auth.routes import router"` succeeds
- [ ] Auth routes included in main app
</verification>

<success_criteria>

- All tasks completed
- JWT token creation and validation works
- Login endpoint accepts credentials
- Protected routes require valid token
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
