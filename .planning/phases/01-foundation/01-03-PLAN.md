---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [backend/wordops/__init__.py, backend/wordops/cli.py, backend/wordops/models.py, backend/wordops/exceptions.py]
autonomous: true
---

<objective>
Create WordOps CLI wrapper module for safe command execution.

Purpose: Provide a Python interface to WordOps CLI commands with proper error handling.
Output: CLI wrapper that can execute `wo` commands and parse output.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CLI wrapper infrastructure</name>
  <files>backend/wordops/__init__.py, backend/wordops/exceptions.py, backend/wordops/cli.py</files>
  <action>
    Create backend/wordops/ directory with __init__.py (empty).

    Create backend/wordops/exceptions.py:
    - WordOpsError(Exception) base class with message, returncode attributes
    - CommandNotFoundError(WordOpsError) - wo binary not found
    - CommandFailedError(WordOpsError) - non-zero exit code
    - ParseError(WordOpsError) - output parsing failed

    Create backend/wordops/cli.py:
    - WO_BINARY constant: "/usr/local/bin/wo" (standard WordOps location)
    - async def run_command(args: list[str], timeout: int = 30) -> str
      - Uses asyncio.create_subprocess_exec to run wo with args
      - Captures stdout/stderr
      - Raises CommandNotFoundError if wo not found
      - Raises CommandFailedError on non-zero exit with stderr
      - Returns stdout on success
      - Timeout protection with asyncio.wait_for
    - async def check_wordops_available() -> bool
      - Runs "wo --version" to verify wo is installed
      - Returns True if successful, False if not found

    Security: NEVER interpolate user input into commands. Always pass as list args.
    All subprocess args must be explicit list items, never shell=True.
  </action>
  <verify>cd /home/william/Projects/WordOps-Dashboard && python3 -c "from backend.wordops.cli import run_command, check_wordops_available; print('CLI wrapper OK')"</verify>
  <done>CLI wrapper imports, has run_command and check_wordops_available</done>
</task>

<task type="auto">
  <name>Task 2: Implement site list command wrapper</name>
  <files>backend/wordops/models.py, backend/wordops/sites.py</files>
  <action>
    Create backend/wordops/models.py:
    - Pydantic model Site: name (str), type (str), ssl (bool), cache (str | None), php_version (str | None)
    - SiteType enum: WORDPRESS, PHP, HTML, PROXY, MYSQL

    Create backend/wordops/sites.py:
    - async def list_sites() -> list[Site]
      - Runs "wo site list"
      - Parses tabular output (site name, type, SSL status, cache type)
      - Returns list of Site objects
      - Returns empty list if no sites
      - Handles parsing gracefully (WordOps output format may vary)
    - async def get_site_info(domain: str) -> Site | None
      - Runs "wo site info {domain}"
      - Parses detailed site information
      - Returns Site object or None if not found

    Note: Domain parameter must be validated (alphanumeric, dots, hyphens only) before passing to CLI.
    Add a validate_domain(domain: str) -> bool helper that rejects anything suspicious.
  </action>
  <verify>cd /home/william/Projects/WordOps-Dashboard && python3 -c "from backend.wordops.sites import list_sites; from backend.wordops.models import Site; print('Sites module OK')"</verify>
  <done>Site listing wrapper exists with proper domain validation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python3 -c "from backend.wordops.cli import run_command"` succeeds
- [ ] `python3 -c "from backend.wordops.sites import list_sites"` succeeds
- [ ] `python3 -c "from backend.wordops.models import Site"` succeeds
</verification>

<success_criteria>

- All tasks completed
- CLI wrapper handles subprocess execution safely
- Site listing command is wrapped with output parsing
- Domain validation prevents command injection
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
