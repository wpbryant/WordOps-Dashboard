---
phase: 02-site-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [backend/wordops/routes.py]
autonomous: true

must_haves:
  truths:
    - "Authenticated user can get site details via GET /api/v1/sites/{domain}"
    - "Valid domain returns site object with type, ssl, cache, php_version"
    - "Invalid domain format returns 400 Bad Request"
    - "Non-existent site returns 404 Not Found"
    - "Unauthenticated requests return 401"
  artifacts:
    - path: "backend/wordops/routes.py"
      provides: "Sites router with detail endpoint"
      contains: "@router.get(\"/{domain}\""
  key_links:
    - from: "backend/wordops/routes.py"
      to: "backend/wordops/sites.py"
      via: "import get_site_info, validate_domain"
      pattern: "from backend\\.wordops\\.sites import.*get_site_info"
---

<objective>
Add site detail endpoint to retrieve detailed information about a specific site.

Purpose: Enable authenticated users to view full details of a single site including PHP version, cache type, and SSL status.

Output: GET `/api/v1/sites/{domain}` endpoint returning site details or appropriate error.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-site-management/02-01-SUMMARY.md
@backend/wordops/routes.py
@backend/wordops/sites.py
@backend/wordops/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add site detail endpoint</name>
  <files>backend/wordops/routes.py</files>
  <action>
Add to backend/wordops/routes.py:

1. Update imports to include get_site_info and validate_domain:
   ```python
   from backend.wordops.sites import list_sites, get_site_info, validate_domain
   ```

2. Add GET /{domain} endpoint after the list endpoint:
   ```python
   @router.get("/{domain}", response_model=Site)
   async def get_site(
       domain: str,
       current_user: User = Depends(get_current_user),
   ) -> Site:
       """Get detailed information about a specific site.

       Args:
           domain: The domain name of the site

       Returns:
           Site object with full details

       Raises:
           400: Invalid domain format
           404: Site not found
           503: WordOps command failed
       """
       # Validate domain format
       if not validate_domain(domain):
           raise HTTPException(
               status_code=status.HTTP_400_BAD_REQUEST,
               detail=f"Invalid domain format: {domain}",
           )

       try:
           site = await get_site_info(domain)
       except ValueError as e:
           raise HTTPException(
               status_code=status.HTTP_400_BAD_REQUEST,
               detail=str(e),
           )
       except Exception as e:
           # WordOps command errors
           raise HTTPException(
               status_code=status.HTTP_503_SERVICE_UNAVAILABLE,
               detail=f"WordOps error: {str(e)}",
           )

       if site is None:
           raise HTTPException(
               status_code=status.HTTP_404_NOT_FOUND,
               detail=f"Site not found: {domain}",
           )

       return site
   ```

The endpoint validates domain format first (preventing malicious input), then calls get_site_info().
  </action>
  <verify>
python -c "from backend.wordops.routes import router; paths = [r.path for r in router.routes]; assert '/{domain}' in paths, f'Detail route not found in {paths}'; print('Detail endpoint added')"
  </verify>
  <done>GET /{domain} endpoint exists with domain validation and proper error handling</done>
</task>

</tasks>

<verification>
1. Run: `python -c "from backend.wordops.routes import router; print([r.path for r in router.routes])"`
   - Expect: Both '/' and '/{domain}' in route list

2. Code inspection:
   - validate_domain() called before get_site_info()
   - 400 returned for invalid domain
   - 404 returned when site is None
   - 503 returned for WordOps errors
</verification>

<success_criteria>
- GET /api/v1/sites/{domain} endpoint exists
- Invalid domain format returns 400
- Non-existent site returns 404
- WordOps errors return 503
- Valid site returns Site object with all fields
</success_criteria>

<output>
After completion, create `.planning/phases/02-site-management/02-02-SUMMARY.md`
</output>
